

### 1. 序列号、确认应答、超时重传

数据到达接收方，接收方发出一个确认应答==表示已经收到该数据段==，并且确认序号会说明了它==下一次需要接收的数据序列号==。如果发送发迟迟未收到确认应答，那么==可能是发送的数据丢失，也可能是确认应答丢失==，这时发送方在等待一定时间后会进行重传。这个时间一般是==2*RTT(报文段往返时间）+一个偏差值==。

### 2. 窗口控制与高速重发控制/快速重传（重复确认应答）

TCP利用窗口控制来==提高传输速度==，窗口大小就是无需等待确认就可以继续发送数据的最大值。

使用窗口控制后，某数据段丢失会发送请求数据的应答，而发送端==连续收到三次同样的请求后会立刻重传==；如果是应答丢失了，一般是不会进行重发

### 3. 拥塞控制

当窗口定义得过大时，会造成网络拥堵甚至瘫痪，因此采用拥塞控制

**慢启动：**最开始将窗口大小定义为1，之后每次收到确认应答（一个rtt），用塞窗口将*2

**拥塞避免：**设置慢启动阈值，当窗口达到这个阈值后，拥塞窗口不再指数上升，而是加法增加，以避免拥塞，报文段的超时重传看做拥塞，一旦发生先将阈值设为当前窗口的一半，窗口设置为1，重新进入慢启动

**快速重传：**接收方收到一个失序的报文段后立即发出重复的确认（为的是使发送方及早知道有报文段没有到达，而不需要等待计时器），按照快重传的规定，当连续收到三个重复确认就立即重传对方未收到的报文段

**快恢复：**一旦出现超时重传或三个重复的ack时，将慢启动门限设为cwnd的一半，并使cwnd=ssthresh（or cwnd=ssthresh+3）



### x. Session&Cookie

HTTP是无状态协议，所以需要采取某种机制来识别具体用户、记录用户状态

当浏览器访问服务器时，服务器会创建一个==session对象==（该对象有一个唯一的id号，称之为sessionId）服务器在默认的情况下，会将sessionId以cookie的方式，发送给浏览器，浏览器会将sessionId保存到内存中当浏览器再次访问服务器时，会将sessionId发送给服务器，服务器依据sessionId就可以找到之间创建的session对象

例如购物车、免密自动登录账号都是用到了Cookie

Q：如果Cookie被禁用？

A：使用==URL重写技术==进行会话跟踪（在每次HTTP交互，URL后面附加上类似于`sid=xxx`这样的参数，服务端据此来识别用户）

### x. 协议

#### 6.1 各层协议功能

**应用层:**提供==用户与网络间的**接口**==

**运输层:**==进程到进程间的数据传输==

**网络层:主机到主机**之间的数据传输，路径选择

**数据链路层:相邻结点**之间的数据传输，格式化数据以进行传输

**物理层:**定义物理设备标准，在物理介质上**传输==比特==流**

#### 6.2 各层协议常用设备

物理层常用设备：中继器、集线器（广播、宽带共享）、网线

数据链路层常用设备：网卡、网桥（多个LAN连在一起，对上层来说好像一个LAN）、交换机（可分割冲突域，不可分割广播域，具有自动侦测的功能）

网络层常用设备：路由器（根据ip选择线路、可分割广播域，为不同类型物理网络提供连接）

传输层常用设备：网关

**多模传输、单模传输：**单模传输距离远、不会发生色散、质量可靠，昂贵；多模传输带宽大、便宜，近距离传输

#### x.3 各层协议封装

 ![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3f9vtf7cj30cu092jsh.jpg)

UDP数据与TCP基本一致，不同的地方在于UDP传给IP信息单元作为UDP数据报，且UDP首部长8字节

服务器是通过端口来识别协议，而客户端对使用的端口号并不关系，只保证该端口在机器上是唯一的，且存在时间短暂

- **以太网封装**

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3fzlhx2xj30ow0amq4k.jpg" style="zoom:80%;" />

字节长度不包括CRC校验码

- **SLIP**：串行线路上对IP数据进行封装的简单形式，头尾END特殊字符，每一端必须知道对方的IP，数据帧中没有类型字段，则一条SLIP线路只能用于SLIP传输；数据帧中没有校验
- **PPP**：点对点协议，针对SLIP作出的改进，有了无奇偶校验模式，支持面向比特的同步链接，可以运行多种协议
- **环回接口**：允许运行在同一主机上的客户程序服务器程序通过TCP/IP通信，大多数情况下为127.0.0.1

#### x. n 物理层数据传输

- 电路交换

通信前建立双方独占物理通道，具有**通信时延小、实时性强、有序传输、避免冲突**等特点，但同时**建立连接时间长、信道利用率低、灵活性差(双方通路中任何一个节点出了故障，要重新建立新的连接)**这些不足之处

- 报文交换

在交换节点采用**存储转发**的传输方式，具有**无需建立连接、动态分配线路、可靠性高(某条传输路径发生故障，可以选择另一条路径)、利用率高**等优点，但是**转发时延、还需要结点具有较大存储缓存空间**，因此主要用于早期的==电报通信网==中

- 分组交换

仍采用**存储转发**的方式，但会将长报文分割成较短的分组，具备**加速传输、较少了出错概率和重传数据量**等优点；分组交换有两种形式：**数据报服务**和**虚电路服务**，前者无需建立连接，网络尽最大努力交付，不保证可靠性，且到达时可能失序，但是由于分组小的缘故，减少的等待延迟，提高了吞吐量，后者在源主机和目标主机之间建立了一个虚连接(**呼叫建立**)，数据将按照路径按顺序到达目的主机（**数据传输**），每个分组首部不包含目的地址，只有虚电路标识符，开销小，当其中某个结点失效后，该条链路也随之失效，通信完成后还要**释放虚电路请求**







#### x.5 DNS

进行域名解析时使用UDP

在域名服务器之间传输使用TCP

##### 递归查询、迭代查询

域名系统：根域名服务器->顶级域名服务器->权限域名服务器

递归查询：本地域名服务器代替主机向根域名请求，根域名服务器继续向下寻找，再逐级返回

迭代查询：每一级域名服务器告诉本地域名服器下一步找哪一个服务器，最后返回给主机

一般主机向本地域名服务器查询是递归查询

##### DNS劫持

指用户访问一个被标记的地址时，DNS服务器故意将此地址指向一个错误的IP地址的行为。范例就是收到各种推送广告等网站

##### DNS污染

指的是用户访问一个地址，国内的服务器(非DNS)监控到用户访问的已经被标记地址时，服务器伪装成DNS服务器向用户发回错误的地址的行为。比如不能访问Google、YouTube等

#### x.6 ARQ



#### x.7 STP

生成树协议，防止网桥网络中冗余链路形成环路

### 8. FDDI

光纤分布式数据接口（Fiber Distributed Data Interface，缩写FDDI）是在光缆网络上发送数字和音频信号的一组协议。FDDI使用==双环令牌传递==网络拓扑结构，两环==方向相反==（以两机来说，两条为一组。一条接收用，一条发送用。）

### 9.PDU

协议数据单元(Protocol Data Unit )：对等同一层之间传输

- 物理层的 PDU是==数据位==（bit）

- 数据链路层的 PDU是==数据帧==（frame）

- 网络层的PDU是==数据包==（packet）

- 传输层的 PDU是==数据段==（segment）

- 其他更高层次的PDU是==报文==（message）

### x. SDU

OSI层与层之间交换数据单元

### 10.TCP/IP协议簇

一组不同层次上多个协议的组合

#### x.1 TCP/IP Protocol Stack

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg28rc2cstj30if0gkq4s.jpg" style="zoom:80%;" />

#### x.2 ARP

转换IP层和网络接口层的地址

#### x.3 RARP



#### x.2 ICMP

==网络层==协议，基于IP工作：

1. 确认IP包是否成功到达目的地址
2. 通知IP包丢失的原因

#### x.3 IGMP

把一个UDP数据报多播到多播到多个主机

#### x.IP

- 为上层提供无状态无连接不可靠服务：
  - 无状态：IP数据报发送传输接收都是相互独立，没有上下文关系的，无法处理乱序和重复的IP数据报（IP数据报头部提供了一个标识字段，是用来处理IP分片和重组的）
  - 无连接：IP通信双方都不长久维持对方任何信息
  - 不可靠：只是尽最大努力传输，中途可能会因为TTL或者检测出错误而被丢弃，并返回ICMP错误信息，不会试图重传

- IP地址

  为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异

  IP地址 = {<网络号>，<主机号>}

  A类地址:1.0.0.0-126.0.0.0（主机号：后24位）

  B类地址:128.0.0.0-191.255.255.255（主机号：后16位）

  C类地址:192.0.0.0-223.255.255.255（主机号：后8位）

  D类地址：多播地址

  E类地址：保留今后使用

  ![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gg35e0ve4uj30al05mjs1.jpg)

  单播地址：单个主机

  广播地址：网络上所有主机

  多播地址：同一组内所有主机



#### TCP

提供可靠连接，字节流传输：序列号、确认应答、超时重传

流量控制：控制发送端发送速率，使之不超过接收端的接受速率，防止出现报文端的丢失，报文长度是根据==对端的接受能力==和==网络状况==来决定的；

拥塞控制：防止过多的报文进入网络，造成路由器与链路过载

- 三次握手：确认双方接收能力和发送能力是否正常，指定自己的初始化序列号，为后面的可靠传输做准备，交换TCP窗口大小信息

  - 第一次握手：建立连接时，客户端设置SYN=1，随机产生seq包(syn=j)到服务器，并进入SYN_SEND状态，等待服务器确认，此时不能携带数据，消耗掉一个序号； 
  - 第二次握手：服务器收到seq包，将SYN和ACK都设置为1，ack=j+1，同时自己也发送一个seq包（seq=k），此时服务器进入SYN_RECV状态； （**服务器收到请求后，由于双方还没有建立连接，服务器会将这种状态放进队列中，称之为半连接队列**）
  - 第三次握手：客户端收到服务器的seq包，将标志位ACK设置为1，ack=k+1向服务器发送确认包ACK(ack=k+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手，此时可以携带数据。（此时连接建立完成，服务器将此种状态放进全连接队列，如果队列满了就有可能会出现丢包现象）
  
  **三次握手必要性**：第一次服务器确认了客户端的发送能力正常，服务端的接收能力正常；第二次客户端确认了服务端的接收、发送能力，客户端的接收、发送能力是正常的，但是服务器端并不确定客户端的接收能力；第三次：服务端就能得出结论：客户端的接收、发送能力正常，服务器自己的发送、接收能力也正常
  
  **SYN攻击：**服务器端的资源分配是在二次握手时分配的，而客户端的资源是在完成三次握手时分配的，所以服务器容易受到SYN洪泛攻击。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server则回复确认包，并等待Client确认，由于源地址不存在，因此Server需要不断重发直至超时，这些伪造的SYN包将长时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪
  
  
  
- 四次挥手：TCP连接是全双工的，所以每个方向都要进行关闭
  - 数据传输结束后，客户端的发出连接释放报文段，进入FIN_WAIT_1状态，此时客户端依旧可以接受服务端发来的数据
  - 服务器收到FIN后，发送ACK给客户端，确认序号为收到序号+1，服务器进入CLOSE_WAIT状态,客户端进入FIN_WAIT_2状态
  - 当服务器发送完数据，发送一个FIN报文，服务器进入LAST_ACK，等待客户端确认
  - 客户端收到FIN报文后，给服务器发送ACK报文，确认序号为收到序号+1，此时客户端进入TIME_WAIT状态，等待2MSL（MSL：报文段最大生存时间），然后关闭连接

#### UDP

无连接，支持一对一、一对多、多对一、多对多交互通信，尽最大努力交付，不保证可靠性；没有拥塞控制，网络拥塞不会影响主机发送效率；适用于实时通信

#### SMTP

**电子邮件的基本格式：**用户名@主机名.域名

可靠且有效的电子邮箱协议，建立在FTP文件传输服务上的邮件服务，是一个“推”的协议，用户到邮箱，邮箱到邮箱

#### POP3

邮箱到用户，明文传输不加密，支持离线处理，是一种存储转发服务，

#### IMAP

邮件获取协议

#### HTTP & HTTPS

HTTP：用于从万维网服务器传输超文本到本地浏览器的传送应用层协议；具有简单快速，通信速度快，可以传输任意类型的数据对象，无连接（每次只处理一个请求）、无状态（对事务处理没有记忆能力），默认端口80（服务器开放的端口），基于TCP协议

- 请求方法：

```
GET: 获取URL指定的资源；
POST：传输实体信息
PUT：上传文件
DELETE：删除文件
HEAD：获取报文首部，与GET相比，不返回报文主体部分
OPTIONS：询问支持的方法
TRACE：追踪请求的路径；
CONNECT：要求在与代理服务器通信时建立隧道，使用隧道进行TCP通信。主要使用SSL和TLS将数据加密后通过网络隧道进行传输
```

- 区别：

  ​	1）HTTP以==明文==的方式传输数据，HTTPS传输的数据是经过==[TLS加密](https://juejin.im/post/5a4f4884518825732b19a3ce)==后的，HTTPS具有更高的安全性

  ​	2）HTTPS在TCP三次握手阶段之后，还需要进行SSL 的handshake（确定双方是如何进行加解密，握手过程中还是明文），协商加密使用的对称加密密钥

  ​	3）HTTPS协议需要==服务端申请证书==，==浏览器端安装==对应的==根证书==

  ​	4）HTTP协议端口是80，HTTPS协议端口是443

- HTTP请求报文：请求行，请求头部，空行，请求数据

  ![preview](https://picb.zhimg.com/v2-c920e11f00c2510d9a8fa4f4009d0f2e_r.jpg)

  - 请求行;
    - 请求方法
    - 请求地址URL：统一资源定位符：<协议>：//<主机>：<端口>/<路径>
    - 协议版本
  - 请求头部：附加信息，最后会有空行，表示头部结束，接下来为数据

  ![img](https://pic1.zhimg.com/v2-a052ad189d00a5068f534a7660208b01_b.jpg)

  - 请求数据：post有



- HTTP 响应报文：状态行、响应头部、空行以及响应数据

  ![](https://pic3.zhimg.com/v2-bdb035a8d48c2715f1fe485fbddb0d76_r.jpg)

  

  - 版本号、状态行
  
![image-20200907164947367](https://tva1.sinaimg.cn/large/007S8ZIlgy1gii6odo8pej30rp0ibahe.jpg)
  
  - 响应头部：服务器程序名字，长度，文档类型，cookie（客户端每次向服务器请求都带上的信息，用以服务端区分不同的用户），空行表结束
  - 响应包组成、状态响应码
  
  

#### MAC地址

是一个硬件地址，用来定义网络设备的位置，主要由==数据链路层==负责



### x. 局域网

- 物理层：处理物理链路上传输的比特流
- 数据链路层
  - 媒体访问控制（MAC）
  - 逻辑链路控制（LLC）：负责屏蔽MAC子层不同实现，使其变成统一的界面，向网络层提供一致的服务



---------



## 数据链路层

### 1.差错控制

网络中以帧为最小单位进行传输数据，为了弄清楚每一帧的开始和结束的位置：

- 字符计数法
- 字节填充首位界符法
- 零比特填充法

#### 1.1检错

- 奇偶校验码
- 循环冗余码
  - r位CRC能够检测小于或等于r位的错误
  - 大于r位的错误逃脱概率是（1/2）^r

#### 1.2纠错

海明码

### 2.流量控制与可靠传输

#### 2.1 流量控制

由接收方控制发送方的数据流

- 停止等待：发送一帧等待应答再发送下一帧
- 滑动窗口：发送方和接收方都维持着一组可以连续接收或发送的帧序号，若数据在接收窗口之外，则丢弃
  - 窗口=1：停止等待协议

#### 2.2 可靠传输

可靠传输分为无比特差错和无传输差错，数据链层仅能实现前者，后者在TCP上实现无传输差错。

**ARQ**

自动重传请求，是数据链路层和传输层的错误纠正协议之一，使用==确认==和==超时==两个机制，在不可靠服务基础上实现==可靠信息传输==，协议简单，广泛应用于分组交换网络中

- 停止等待ARQ：发送数据包后，在一定时间内等待回应，超出时间重传，传输数据速度低
- 连续ARQ：为克服等待时间过长，连续发送一组数据包，等待数据包的ACK
  - 回退N重传：接收点丢弃从第一个没有接收到书包开始的所有数包，发送点从NACK后开始重传
  - 选择重传：每个数据包都有一个计时器，超出时间后，发送点重发超时的数据包

纠错方法：丢弃含有错误的数据包，请求重发

### 3. 介质访问控制

控制在一个传输介质上复用主机访问信道时避免冲突的协议

**CSMA**

- ==1-坚持==：监听信道，忙则持续等待监听，空闲立刻传输，冲突即停止，随机等待一定时间后再监听，==冲突性很大==
- ==非坚持==：空闲就传输，忙则不等待，随机一个时间后再监听，==信道利用率不高==
- ==p坚持==：监听信道，空闲则以p概率传输，忙则等待下一个时间槽

**CSMA/CD**

带冲突检测，随机后退（截断二进制后退算法）

### 4.设备

- 网桥：过滤帧的功能，连接不同物理层，缺点是会增加转发时延，信息量过大时会产生网络拥塞，即广播风暴
- 局域网交换机：多端口网桥



## 网络层

### 功能

#### 路由与转发

- 路由选择：当使用数据报来传输数据时，每一个进来的分组都要重新选择路由（虚电路不用）
- 分组转发：将用户ip数据报从合适的端口转发出去

#### 拥塞控制

- 开环控制：事先确定好发生拥塞的因素及解决方法，运行后不再修改
- 闭环控制：实时检测，监控系统



### 路由算法

#### 静态路由

简单、开销小、小网络、手动配置

#### 动态路由

较好适应网络变化、复杂、开销大

- 距离向量路由算法：每个节点每次更新都将全部路由表发送给临近结点
- 链路状态路由算法：每个节点有完全的网络拓扑的信息 







## x. 英文对照表

|  WAN   |       广域网       | IP协议 |      网际协议      |
| :----: | :----------------: | :----: | :----------------: |
|  ICMP  | 互联网控制报文协议 |  IGMP  | Internet组管理协议 |
|  TCP   |    传输控制协议    |  UDP   |   用户数据报协议   |
|  FTP   |    文件传输协议    |  SMTP  |  简单邮件传输协议  |
|  SNMP  |  简单网络管理协议  |  LAN   |       局域网       |
| Router |       路由器       |  VLAN  |     虚拟局域网     |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |
|        |                    |        |                    |

