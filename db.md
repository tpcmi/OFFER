## 数据库索引

索引是对数据库表中一列或多列的值进行排序的一种结构，主要目的就是加快检索表中数据的方法，亦能尽快的找到符合限制条件的记录ID

优点:

- 保证了数据的唯一性
- 加快了数据的检索速度
- 加速表与表之间的连接
- 使用分组和排序子句进行数据检索时，可以显著减少查询中分组和排序的时间
- 优化隐藏器,提高系统性能

缺点:

- 创建和维护索引要耗费时间,且随着数据量的增加而增加
- 索引占物理空间
- 对表中数据进行增加、删除和修改时，索引也要动态的维护，降低了数据的维护速度

添加索引原则:

- 查询少或参考列不添加索引
- 数据值少不添加
- 修改性能远大于检索性能不添加

索引底层实现：

B+树

## 数据库事务

事务是数据库运行中的逻辑工作单位，必须满足ACID（原子性、一致性、隔离性和持久性）属性，因此要么完全地执行，要么完全地不执行

- 原子性:务包含的所有操作要么全部成功，要么全部失败回滚
- 一致性:事务必须使数据库从一个一致性状态到另一个一致性状态
- 隔离性:同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰,多个用户并发访问数据库时，如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离
- 持久性:事务一旦被提交，对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作





## inner join & left join

left join(左联接) 返回所有左表指定行,右表进行匹配,若无匹配则所在行为空值; right join(右联接)同

inner join(等值连接) 只返回两个表中联结字段相等的行

## 数据库三大范式

第一范式：表字段不能冗余（关系模式R的所有属性都不能再分解为更基本的数据单位,指的是属性要根据实际需求来定,如果要经常获得某个属性的一部分信息,则该表不符合第一范式）

第二范式：（每张表都要有主键）如果关系模式R满足第一范式，并且R的所有非主属性都完全依赖于R的每一个候选关键属性，主要针对联合主键,表中的属性不能仅仅只依赖联合主键中的某一主键,这样可以避免数据的冗余

第三范式：（依靠主键进行关联）设R是一个满足第一范式条件的关系模式，X是R的任意属性集，如果X非传递依赖于R的任意一个候选关键字，称R满足第三范式，即非主属性不传递依赖于键码

## 数据库底层数据结构

- 如果直接顺序存入读取，非常耗时
- 二叉搜索树：可以用类似于二分查找的方式实现快速查找，但是可能会退化为链表，查找效率变低
- AVL树：在符合二叉查找树的条件下，还满足任何节点的两个子树的高度最大差为1，但是由于追求绝对的平衡，导致在插入删除很多的时候旋转次数也会变多
- 红黑树：放弃了完全平衡，解决了插入删除频繁调整的情况，但是深度不可控
- hash：根据key计算出应该存储地址的位置，但是需要好的hash函数，解决冲突，可以快速查询，固定深度，效率高，但是hash不是按照索引值顺序存储，无法用于排序和范围查询
- B树：多叉搜索树，主要用于存储文件系统和数据库系统当中，树节点记录磁盘上的位置，即在数据库当中遍历树的时候也伴随着磁盘读取，相对树而言深度更小
- B+树：所有根节点不带任何数据信息，整个树的每个节点所占的内存空间就变小了，读到内存中的索引信息就会更多一些，相当于减少了磁盘IO次数，B+树会以一个链表的形式将所有叶子节点的信息全部串联起来，这样，想遍历所有数据信息只需要顺序遍历叶子节点



## mysql 四种隔离状态

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggtp640nfzj30dw097aaa.jpg)

- 脏读：一个事务中访问到了另外一个事务未提交的数据，后来数据改变了也不知道
- 幻读：一个事务读取2次，得到的记录条数不一致（重点在增删）
- 不可重复读：一个事务读取同一条记录2次，得到的结果不一致（重点在修改）

## mysql 的MVCC机制

是一种多版本并发控制机制，是InnoDB存储引擎实现隔离级别的一种具体方式（读提交、可重复读）。MVCC保存数据在某个时间点的快照，Undo日志通过回滚指针把一个数据行所有快照连接起来

## SQL优化方法

- 建立索引对查询优化
- 对查询进行优化，避免全表扫描

## SQL注入

针对程序员编写时的疏忽，通过SQL语句，实现无账号登录，甚至篡改数据库

## MYSQL引擎和区别

### InnoDB

事务型的存储引擎，提供了对数据库ACID事务的支持，并且实现了SQL标准的四种隔离级别，有行级锁定（当有限定范围的修改数据时，不会锁定整张表，适合并发的环境）和外键约束；适用于经常更新的表，适合处理多重并发的更新请求

#### 后台线程

- Master 线程：主要负责将缓冲池中的数据异步刷新到磁盘，保证数据的一致性
- IO线程：处理写IO请求

#### auto_increment

是一个约束条件，如果某个字段加入了这个约束条件，在插入数据时，没有给该字段指定一个值，就会自动插入一个自增长的值，

### Mylsam

没有提供对数据库事务的支持，也不支持行级锁和外键，当INSERT或UPDATE数据时需要锁定整个表,易于管理和快速处理，

## Mysql数据库优化

- 设计良好的数据库结构，允许部分数据冗余，尽量避免join查询
- mysql主从读写分离（ 主数据库负责事务增、改、删从数据库处理读操作，从数据库通过生成的binlog来同步主数据库的操作；读写分离的意义在于数据库的写入影响了查询的效率，同时可以提升服务器安全）
- 添加缓存机制（以key-value的形式缓存sql以及结果，不需要解析，优化，执行sql）
- 书写高效的sql
- 选择正确的引擎
  - 尽量把字段设置成NOTNULL

## 锁的优化策略

- 读写分离

- 分段加锁

- 减少锁持有时间

  

